import java.util.Random;

public class Percolation {
	private int[] grid;
	private int[] id;
	private int[] sz;
	private int count;
	
	public Percolation(int n) {
		if(n <= 0)
			throw new IllegalArgumentException();
		grid = new int[n*n];
		id = new int[n*n];
		sz = new int[n*n];
		for(int i=0; i<grid.length; i++) {
			int row=0;
			int col=i;
			if(i>=n) {
				col = i%n;
				row = n*(int)Math.floor(i/n);
			}
			open(row,col,n);
			id[i] = i;
			sz[i] = 1;
		}
	}
	
	private void open(int row, int col, int n) {
		Random random = new Random();
		if(random.nextInt(2) == 1) {
			grid[(row*n)+col] = 1;
			if(row-1 > 0 && isOpen(row-1,col,n))
				union((row*n)+col,((row-1)*n)+col);
			if(col-1 > 0 && isOpen(row,col-1,n))
				union((row*n)+col,((row)*n)+(col-1));
			count++;
		}
	}
	
	public boolean isOpen(int row, int col, int n) {
		if(row < 0 || row > n-1 || col < 0 || col > n-1)
			throw new IllegalArgumentException();
		if(grid[(row*n)+col] == 1)
			return true;
		return false;
	}
	
	public boolean isFull(int row, int col, int n) {
		if(row < 1 || row > n || col < 1 || col > n)
			throw new IllegalArgumentException();
		if(((row-1)*n)+col == 0)
			return true;
		return false;
	}
	
	public int numberOfOpenSites() {
		return count;
	}
	
	public boolean percolates(int n) {
		for(int i=grid.length-n; i<grid.length; i++)
			if(root(i) < n)
				return true;
		return false;
	}
	
	private int root(int i) {
		while(id[i] != i) {
			id[i] = id[id[i]];
			i = id[i];
		}
		return i;
	}
	
	private void union(int i, int j) {
		int p = root(i);
		int q = root(j);
		if(p == q)
			return;
		if(sz[p] < sz[q]) {
			id[p] = q;
			sz[q] += sz[p];
		} else {
			id[q] = p;
			sz[p] += sz[q];
		}
	}
}
